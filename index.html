<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Best Print — 3D печать</title>
<style>
  /* =========================
     :root - основные переменные (цвета и размеры)
     ========================= */
  :root{
    --bg: #ffffff;           /* фон сайта (строго белый) */
    --accent: #ffd400;       /* жёлтый акцент */
    --black: #000000;        /* чёрный для сильных элементов */
    --overlay: rgba(0,0,0,0.45);

    --header-h: 72px;        /* высота верхней панели (строго 72px) */

    /* размеры в px (обязательно указывать в :root и явно у элементов) */
    --btn-padding: 12px 20px;
    --input-width: 520px;
    --input-height: 52px;
    --hero-h: calc(100vh - var(--header-h));
    --catalog-card-w: 300px;
    --product-image-w: 520px;
    --product-image-h: 380px;
    --gen-textarea-w: 720px;
    --gen-textarea-h: 240px;
    --file-preview-size: 240px;
    --email-width: 420px;
    --email-height: 44px;
    --border-radius: 12px;
    --transition-fast: 180ms;
  }

  /* базовый сброс */
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; background:var(--bg); color:var(--black); font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;}
  button{font-family:inherit; cursor:pointer}
  a{color:inherit}

  /* =========================
     ФИКСИРОВАННАЯ ВЕРХНЯЯ ПАНЕЛЬ (header)
     position: fixed; top:0; left:0; right:0; height:72px; background:#ffffff;
     Содержит 3 интерактивных элемента в одну линию:
       - слева: [Каталог][Генерация]
       - справа: [Best Print] (кликабельна -> goPage('home'))
     ========================= */
  header.topbar{
    position: fixed;
    top:0;
    left:0;
    right:0;
    height: var(--header-h); /* 72px */
    background: #ffffff; /* строго белый */
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 20px;
    z-index:1000;
    box-shadow: 0 1px 6px rgba(0,0,0,0.06);
  }
  header .left {
    display:flex;
    gap:12px;
    align-items:center;
  }
  header .left button {
    background: var(--accent);
    color: var(--black);
    padding: var(--btn-padding);
    border-radius: 10px;
    border:1px solid rgba(0,0,0,0.06);
    height:44px;
  }
  header .brand {
    font-weight:700;
    font-size:18px;
    cursor:pointer;
    user-select:none;
    padding:8px 12px;
    border-radius:8px;
  }

  /* =========================
     Основной контейнер (контент) - отступ сверху чтобы header не перекрывал контент
     Каждая секция (.page) должна занимать высоту viewport minus header (полноэкранная)
     ========================= */
  main#app {
    padding-top: var(--header-h); /* чтобы header не перекрывал */
  }
  .page{
    min-height: calc(100vh - var(--header-h)); /* каждая страница полноэкранная */
    display:none;
    padding: 24px;
    box-sizing:border-box;
  }
  .page.active{ display:block; }

  /* =========================
     HOME / HERO
     ========================= */
  /* make the hero a positioned flex container so pseudo-elements are anchored
     to it and its .inner content is centered both vertically and horizontally */
  .hero{
    position: relative;
    min-height: var(--hero-h);
    display: flex;
    align-items: center;
    justify-content: center;
  }
.hero::before {
    content: "";
    position: absolute;
    inset: 0;
    background-image: url('https://static2.3d4u.com.ua/img/ybc_blog/post/3d-printed-valentine-main.jpg'); /* путь к твоему фону */
    background-position: center;   /* центрируем изображение */
    background-size: cover;        /* масштабируем так, чтобы полностью покрывало блок */
    background-repeat: no-repeat;  /* не повторяем */
    filter: saturate(0.95) contrast(0.95); /* фильтры можно оставить */
    z-index: 0;
}


  #home .hero::after{
    content:"";
    position:absolute;
    inset:0;
    background: var(--overlay);
    z-index:1;
  }
  #home .hero .inner {
    position:relative; z-index:2; max-width:1100px; width:100%;
  }
  #home h1.hero-title {
    margin:0;
    font-size:64px;
    color:#ffffff; /* строго белый */
    cursor:pointer;
  }
  #home p.hero-sub {
    margin-top:12px;
    font-size:18px;
    color:#ffffff;
    opacity:0.95;
  }

  /* typewriter */
  #typewriter {
    margin-top:24px;
    font-size:20px;
    color:#ffffff;
    white-space:nowrap;
    overflow:hidden;
    border-right:2px solid rgba(255,255,255,0.8);
    display:inline-block;
    vertical-align:middle;
    opacity:0;
    transform:translateY(6px);
    transition: opacity 240ms ease, transform 240ms ease;
  }

  /* CTA button */
  #heroOrder {
    margin-top:28px;
    padding:12px 20px;
    border-radius:10px;
    background: var(--accent);
    color: var(--black);
    font-weight:700;
    border:none;
    transform: translateX(140px);
    opacity:0;
    transition: transform 420ms cubic-bezier(.22,.9,.2,1), opacity 360ms;
  }
  #heroOrder.in-place { transform: translateX(0); opacity:1; }

  /* catalog-preview under hero (yellow background) */
  .catalog-preview {
    margin-top:24px;
    background: var(--accent); /* #ffd400 */
    padding:20px;
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
  }
  .catalog-preview .title { font-weight:700; font-size:20px; color:var(--black); }
  .catalog-preview .cards { display:flex; gap:12px; align-items:center; }
  .catalog-preview .catalog-card {
    width:160px; height:120px; border-radius:10px;
    background: linear-gradient(135deg,#f7f7f7,#e1e1e1);
    display:flex; align-items:center; justify-content:center; font-weight:700; color:#333;
  }
  .catalog-preview .open-catalog {
    background: var(--black);
    color:#fff;
    padding:12px 20px;
    border-radius:999px;
    border:none;
    width:200px; height:44px;
  }

  /* =========================
     TEAM / ABOUT (AR page)
     ========================= */
  #AR .team-wrap { max-width:1100px; width:100%; margin:12px 0; display:flex; flex-direction:column; gap:12px; }
  #AR .member { background:#fff; border-radius:12px; padding:14px; box-shadow:0 6px 18px rgba(0,0,0,0.04); display:flex; align-items:center; justify-content:space-between; gap:12px; }
  #AR .member .meta { display:flex; flex-direction:column; gap:4px; }
  #AR .member .name { font-weight:700; font-size:16px; }
  #AR .member .role { color:#666; font-size:14px; }
  #AR .member .links a { color:var(--black); text-decoration:none; margin-left:8px; font-weight:600; }
  @media (max-width:900px){ #AR .member{ flex-direction:column; align-items:flex-start; } #AR .member .links{ margin-top:8px; } }

  /* =========================
     ORDER (каталог)
     ========================= */
  #order .title-row { display:flex; align-items:center; justify-content:center; gap:12px; margin-top:6px; }
  input.search-input {
    width:520px; height:52px; padding:12px 14px; border-radius:10px; border:1px solid #cfcfcf; font-size:16px;
  }
  button.to-gen {
    padding:10px 14px; border-radius:10px; background:var(--accent); border:none; height:44px;
  }

  .full-catalog {
    margin-top:20px;
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap:16px;
  }
  .catalog-item {
    background:#fff; border-radius:12px; padding:12px; box-shadow:0 6px 18px rgba(0,0,0,0.04); transition:transform 0.2s, box-shadow 0.2s; cursor:pointer; border:1px solid #f2f2f2;
  }
  .catalog-item:hover { transform: translateY(-6px); box-shadow:0 12px 30px rgba(0,0,0,0.08); }
  .catalog-item .thumb { width:100%; height:160px; border-radius:8px; background:linear-gradient(135deg,#f4f4f4,#e9e9e9); display:flex; align-items:center; justify-content:center; font-weight:700; color:#666; margin-bottom:10px; }
  .catalog-item h3 { margin:0; font-size:16px; }
  .catalog-item p { margin:8px 0 0 0; color:#666; font-size:13px; }

  /* =========================
     PRODUCT
     ========================= */
  #product .product-wrap { display:flex; gap:24px; align-items:flex-start; flex-wrap:wrap; margin-top:12px; }
  .product-left { width:520px; }
  .product-main { width:520px; height:380px; border-radius:12px; background:linear-gradient(135deg,#f4f4f4,#e9e9e9); display:flex; align-items:center; justify-content:center; font-weight:700; color:#666; }
  .thumbs { display:flex; gap:8px; margin-top:10px; }
  .thumbs .mini { width:86px; height:68px; border-radius:8px; background:#efefef; display:flex; align-items:center; justify-content:center; cursor:pointer; border:2px solid transparent; }
  .thumbs .mini.active { border-color: var(--accent); transform:scale(1.02); }
  .option-btn { padding:8px 12px; border-radius:10px; border:1px solid #ddd; background:#fff; cursor:pointer; min-width:80px; }
  .option-btn.active { border-color:var(--black); box-shadow:0 6px 18px rgba(0,0,0,0.06); }
  .order-btn { background:var(--black); color:#fff; padding:12px 18px; border-radius:10px; border:none; cursor:pointer; width:180px; height:48px; font-weight:700; margin-top:12px; }

  /* =========================
     MODAL
     ========================= */
  .modal-backdrop { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,0.35); z-index:2000; }
  .modal-backdrop.show { display:flex; }
  .modal { width:420px; background:#fff; border-radius:12px; padding:22px; border:2px solid #e0e0e0; text-align:center; position:relative; }
  .modal .close { position:absolute; right:10px; top:8px; background:transparent; border:none; font-size:18px; cursor:pointer; }

  /* =========================
     GENERATE
     ========================= */
  .gen-wrap { display:flex; gap:20px; align-items:flex-start; flex-wrap:wrap; margin-top:12px; }
  .gen-left { width:740px; max-width:100%; }
  textarea#prompt { width:720px; height:240px; padding:12px; border-radius:10px; border:1px solid #ddd; resize:none; font-size:15px; }
  .file-preview { width:240px; height:240px; border-radius:10px; background:#f7f7f7; border:1px dashed #ddd; display:flex; align-items:center; justify-content:center; }
  input#email { width:420px; height:44px; padding:8px 12px; border-radius:8px; border:1px solid #ccc; }

  .send-btn { margin-top:12px; padding:12px 18px; border-radius:10px; background:var(--accent); border:none; cursor:pointer; font-weight:700; width:160px; height:44px; }

  /* =========================
     Медиа-запросы
     ========================= */
  @media (max-width:900px){
    #home h1.hero-title{ font-size:40px; }
    .product-left, .product-main { width:100%; height:auto; }
    textarea#prompt { width:100%; }
    input.search-input { width:100%; }
    header.topbar { padding:0 12px; }
  }
</style>
</head>
<body>

<!-- HEADER: фиксированная верхняя панель -->
<header class="topbar" role="banner" aria-label="Верхняя панель">
  <div class="left" role="navigation" aria-label="Левая навигация">
    <button id="navCatalog" aria-label="Каталог" onclick="goPage('order')">Каталог</button>
    <button id="navGen" aria-label="Генерация" onclick="goPage('gen')">Генерация</button>
    <button id="navAuthtor" aria-label="О нас" onclick="goPage('AR')">О нас</button>
  </div>
  <div class="brand" id="brand" role="link" aria-label="Best Print — на главную" onclick="goPage('home')">Best Print</div>
</header>

<!-- MAIN APP: страницы -->
<main id="app">
  <!-- HOME -->
  <section id="home" class="page active" aria-labelledby="homeTitle">
    <div class="hero" role="region" aria-label="Главный экран">
      <div class="inner">
        <h1 id="homeTitle" class="hero-title" onclick="goPage('home')" aria-label="Best Print">Best Print</h1>
        <p class="hero-sub">Генерация и печать 3d моделей на заказ</p>

        <div id="typewriter" aria-hidden="false"></div>

        <div>
          <button id="heroOrder" aria-label="Заказать" onclick="goPage('order')">Заказать ➜</button>
        </div>

        <div class="catalog-preview fade-up" id="catalogPreview" aria-label="Превью каталога" style="margin-top:28px;">
          <div class="title">Ознакомьтесь с нашим каталогом</div>
          <div class="cards">
            <div id="previewCard0" class="catalog-card" role="img" aria-label="Модель 1">Модель 1</div>
            <div id="previewCard1" class="catalog-card" role="img" aria-label="Модель 2">Модель 2</div>
            <div id="previewCard2" class="catalog-card" role="img" aria-label="Модель 3">Модель 3</div>
          </div>
          <div>
            <button class="open-catalog" aria-label="Открыть каталог" onclick="goPage('order')">Открыть каталог</button>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- AR: команда / о нас -->
  <section id="AR" class="page" aria-labelledby="arTitle">
    <h2 id="arTitle">Команда проекта</h2>

    <div class="team-wrap">
      <div class="member" role="group" aria-label="Артём">
        <div class="meta">
          <div class="name">Артём</div>
          <div class="role">3D печать, настройка моделей, обработка</div>
        </div>
        
      </div>

      <div class="member" role="group" aria-label="Тимур">
        <div class="meta">
          <div class="name">Тимур</div>
          <div class="role">Генерация моделей, работа с изображениями, работа с заказами</div>
        </div>
        <div class="links">
          <a href="https://t.me/Name2" target="_blank" rel="noopener">Telegram</a>
        </div>
      </div>

      <div class="member" role="group" aria-label="Bester">
        <div class="meta">
          <div class="name">Bester</div>
          <div class="role">Код, разработка, техническая работа</div>
        </div>
        <div class="links">
          <a href="https://t.me/Bester_play" target="_blank" rel="noopener">Telegram</a>
          <a href="https://github.com/BesterYt" target="_blank" rel="noopener">GitHub</a>
        </div>
      </div>

    </div>
  </section>

  <!-- ORDER -->
  <section id="order" class="page" aria-labelledby="orderTitle">
    <h2 id="orderTitle">Каталог моделей</h2>

    <div class="title-row" style="margin-top:12px;">
      <input id="searchInput" class="search-input" type="search" placeholder="Поиск готовых моделей" oninput="searchModels(this.value)" aria-label="Поиск готовых моделей" style="width:520px; height:52px;" />
      <button class="to-gen" aria-label="Перейти к генерации" onclick="goPage('gen')">Генерировать</button>
    </div>

    <div id="catalogGrid" class="full-catalog" aria-live="polite" style="margin-top:18px;">
      <!-- renderCatalog(list) заполнит -->
    </div>
  </section>

  <!-- PRODUCT -->
  <section id="product" class="page" aria-labelledby="productTitle">
    <h2 id="productTitle">Карточка товара</h2>

    <div class="product-wrap">
      <div class="product-left">
        <div id="productMainImg" class="product-main" role="img" aria-label="Основное изображение">Основное изображение</div>
        <div id="productThumbs" class="thumbs" aria-label="Миниатюры"></div>
      </div>

      <div class="product-right">
        <h3 id="productName">Название модели</h3>
        <div id="productPrice" style="font-weight:700;margin-top:6px;">Цена печати: X ₽</div>

        <div style="margin-top:12px;">Выбор цвета пластика:</div>
        <div id="colorOptions" style="display:flex; gap:8px; margin-top:8px;">
          <button class="option-btn active" onclick="select(this)" data-value="Красный" aria-pressed="true">Красный</button>
          <button class="option-btn" onclick="select(this)" data-value="Синий">Синий</button>
          <button class="option-btn" onclick="select(this)" data-value="Зелёный">Зелёный</button>
        </div>

        <div style="margin-top:12px;">Выбор размера:</div>
        <div id="sizeOptions" style="display:flex; gap:8px; margin-top:8px;">
          <button class="option-btn active" onclick="select(this)" data-value="4см">4см</button>
          <button class="option-btn" onclick="select(this)" data-value="8см">8см</button>
          <button class="option-btn" onclick="select(this)" data-value="10см">10см</button>
          <button class="option-btn" onclick="select(this)" data-value="15см">15см</button>
        </div>

        <div id="productDescription" style="margin-top:12px; color:#444;">Описание товара...</div>

        <button class="order-btn" aria-label="Заказать товар" onclick="placeOrder()">Заказать</button>
      </div>
    </div>
  </section>

  <!-- GEN -->
  <section id="gen" class="page" aria-labelledby="genTitle">
    <h2 id="genTitle">Генерация</h2>

    <div class="gen-wrap">
      <div class="gen-left">
        <label for="prompt">Промпт</label><br/>
        <textarea id="prompt" placeholder="Опишите модель..." aria-label="Промпт" style="width:720px; height:240px;"></textarea>

        <div style="margin-top:12px; display:flex; gap:12px; align-items:flex-start;">
          <div>
            <label for="fileAttach">Прикрепить картинку</label><br/>
            <input id="fileAttach" type="file" accept="image/*" onchange="previewFile(event)" aria-label="Прикрепить картинку" />
          </div>
          <div id="filePreview" class="file-preview" aria-hidden="true">Превью</div>
        </div>
      </div>

      <div class="gen-right">
        <label for="email">Ваша почта</label><br/>
        <input id="email" type="email" placeholder="Ваша почта" aria-label="Ваша почта" style="width:420px; height:44px;" />

        <div style="margin-top:12px;">Выбор размера:</div>
        <div id="genSizeOptions" style="display:flex; gap:8px; margin-top:8px;">
          <button class="option-btn active" onclick="select(this)" data-value="4см">4см</button>
          <button class="option-btn" onclick="select(this)" data-value="8см">8см</button>
          <button class="option-btn" onclick="select(this)" data-value="10см">10см</button>
          <button class="option-btn" onclick="select(this)" data-value="15см">15см</button>
        </div>

        <div id="genHint" style="color:#c00; margin-top:8px; display:none;"></div>

        <button class="send-btn" onclick="submitGenerate()" style="margin-top:12px;">Отправить</button>
        <div style="margin-top:12px; font-size:13px; color:#666;">TODO: интегрировать API генерации и отправки почты.</div>
      </div>
    </div>
  </section>
</main>

<!-- MODAL -->
<div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal" role="document">
    <button class="close" aria-label="Закрыть" onclick="closeModal()">✕</button>
    <div style="font-size:48px; margin-bottom:12px;">✔</div>
    <div style="font-weight:700; font-size:18px;">Заказ успешно размещён</div>
    <div style="margin-top:8px; color:#666;">Мы свяжемся с вами по указанной почте</div>
  </div>
</div>

<script>
/* =========================================================================
   JAVASCRIPT: все требуемые функции и логика (имена нельзя менять)
   Проверки и комментарии там, где менять данные продуктов/изображения/цен.
   ========================================================================= */

/* =========================
   PRODUCTS: Массив из 10 моделей
   Комментарии в этом блоке:
   // name = название модели
   // price = цена печати (строка, например "500 ₽")
   // description = описание
   // images = массив путей/placeholder (see constants below)
   Изменяйте эти поля по необходимости.
   ========================= */
// Placeholder URL constants — replace the 'url_here' value with a real image URL when ready.
// Note: identifiers use underscores (placeholder_1a) because hyphens are invalid in JS identifiers.
const placeholder_1a = 'https://media.printables.com/media/prints/1181036/images/8883329_ed92587f-7bdb-4584-8233-bd0fdd19ab49_0d9875d4-1d97-4881-b12a-bc90166c6428/thumbs/inside/1280x960/jpg/photo_5850211852401886192_y.webp';
const placeholder_1b = 'https://media.printables.com/media/prints/1181036/images/8883325_4171b6b0-9d2a-4e67-8123-9037827e8a2e_e2910d92-b739-4cc3-bf1d-a3c7aa70f3b4/thumbs/inside/1280x960/jpg/photo_5850211852401886202_y.webp';
const placeholder_2a = 'https://media.printables.com/media/prints/499926/images/4065564_4fc7cfbe-ba74-498e-b4b9-0bcfb5f732b6/thumbs/inside/1280x960/png/lpcats1.webp';
const placeholder_2b = 'https://via.placeholder.com/160x120?text=Model+2+thumb';
const placeholder_3a = 'https://via.placeholder.com/520x380?text=Model+3';
const placeholder_3b = 'https://via.placeholder.com/160x120?text=Model+3+thumb';
const placeholder_4a = 'https://via.placeholder.com/520x380?text=Model+4';
const placeholder_4b = 'https://via.placeholder.com/160x120?text=Model+4+thumb';
const placeholder_5a = 'https://via.placeholder.com/520x380?text=Model+5';
const placeholder_5b = 'https://via.placeholder.com/160x120?text=Model+5+thumb';
const placeholder_6a = 'https://via.placeholder.com/520x380?text=Model+6';
const placeholder_6b = 'https://via.placeholder.com/160x120?text=Model+6+thumb';
const placeholder_7a = 'https://via.placeholder.com/520x380?text=Model+7';
const placeholder_7b = 'https://via.placeholder.com/160x120?text=Model+7+thumb';
const placeholder_8a = 'https://via.placeholder.com/520x380?text=Model+8';
const placeholder_8b = 'https://via.placeholder.com/160x120?text=Model+8+thumb';
const placeholder_9a = 'https://via.placeholder.com/520x380?text=Model+9';
const placeholder_9b = 'https://via.placeholder.com/160x120?text=Model+9+thumb';
const placeholder_10a = 'https://via.placeholder.com/520x380?text=Model+10';
const placeholder_10b = 'https://via.placeholder.com/160x120?text=Model+10+thumb';
// Main catalog thumbnail URLs list — paste your main-catalog/thumb URLs here (one per product).
// If a slot is empty string '', the code will fall back to product.images[0].
// Order: index 0 -> product 1, index 1 -> product 2, ... index 9 -> product 10
const mainCatalogUrls = [
  placeholder_1a, // product 1 catalog thumbnail (you can replace this with a full URL)
  placeholder_2a, // product 2
  placeholder_3a, // product 3
  placeholder_4a, // product 4
  placeholder_5b, // product 5
  placeholder_6b, // product 6
  placeholder_7b, // product 7
  placeholder_8b, // product 8
  placeholder_9b, // product 9
  placeholder_10b // product 10
];
const products = [
  // name = "Модель 1", price = "X ₽", description = "...", images = [...]
  { name: "Медведь на ключи", price: "150₽, 200₽, 250₽, 300₽", description: "Описание модели 1", images: [placeholder_1a, placeholder_1b] },
  { name: "Модель 2", price: "X ₽", description: "Описание модели 2", images: [placeholder_2a, placeholder_2b] },
  { name: "Модель 3", price: "X ₽", description: "Описание модели 3", images: [placeholder_3a, placeholder_3b] },
  { name: "Модель 4", price: "X ₽", description: "Описание модели 4", images: [placeholder_4a, placeholder_4b] },
  { name: "Модель 5", price: "X ₽", description: "Описание модели 5", images: [placeholder_5a, placeholder_5b] },
  { name: "Модель 6", price: "X ₽", description: "Описание модели 6", images: [placeholder_6a, placeholder_6b] },
  { name: "Модель 7", price: "X ₽", description: "Описание модели 7", images: [placeholder_7a, placeholder_7b] },
  { name: "Модель 8", price: "X ₽", description: "Описание модели 8", images: [placeholder_8a, placeholder_8b] },
  { name: "Модель 9", price: "X ₽", description: "Описание модели 9", images: [placeholder_9a, placeholder_9b] },
  { name: "Модель 10", price: "X ₽", description: "Описание модели 10", images: [placeholder_10a, placeholder_10b] }
];

/* =========================
   renderCatalog(list) — рендерит карточки в #catalogGrid
   Не переименовывать.
   ========================= */
function renderCatalog(list){
  const grid = document.getElementById('catalogGrid');
  grid.innerHTML = '';
  list.forEach((p, idx) => {
    const item = document.createElement('div');
    item.className = 'catalog-item';
    item.tabIndex = 0;
    item.setAttribute('role','button');
    item.setAttribute('aria-label', `Открыть ${p.name}`);

    const thumb = document.createElement('div');
    thumb.className = 'thumb';
    // show image background if images[0] present (treat any non-empty string as path)
  // prefer explicit main-catalog URL list if provided, otherwise use product images[0]
  const imgVal = (typeof mainCatalogUrls !== 'undefined' && mainCatalogUrls[idx]) ? mainCatalogUrls[idx] : ((p.images && p.images[0]) || '');
    if(imgVal){
      // wrap in quotes to support URLs with query strings
      thumb.style.backgroundImage = `url("${imgVal}")`;
      thumb.style.backgroundSize = 'cover';
      thumb.style.backgroundPosition = 'center';
    } else {
      // fallback: show name text if no image value
      thumb.textContent = p.name;
    }
    thumb.setAttribute('aria-label', p.name);
    item.appendChild(thumb);

    const title = document.createElement('h3');
    title.textContent = p.name;
    item.appendChild(title);

    const price = document.createElement('p');
    price.textContent = 'Цена печати: ' + (p.price || 'X ₽');
    item.appendChild(price);

    item.onclick = () => openProduct(p);
    item.onkeypress = (e) => { if(e.key === 'Enter') openProduct(p); };

    grid.appendChild(item);
  });
}

/* =========================
   searchModels(q) — фильтрация (oninput="searchModels(this.value)")
   Не переименовывать.
   ========================= */
function searchModels(q){
  const qnorm = (q || '').trim().toLowerCase();
  if(!qnorm){
    renderCatalog(products.slice());
    return;
  }
  const filtered = products.filter(p => (p.name && p.name.toLowerCase().includes(qnorm)) || (p.description && p.description.toLowerCase().includes(qnorm)));
  renderCatalog(filtered);
}

/* =========================
   openProduct(p) — открывает страницу product и наполняет поля.
   Не переименовывать.
   ========================= */
let currentProduct = null;
function openProduct(p){
  currentProduct = p;

  document.getElementById('productName').textContent = p.name;
  document.getElementById('productPrice').textContent = 'Цена печати: ' + (p.price || 'X ₽');
  document.getElementById('productDescription').textContent = p.description || '';

  const main = document.getElementById('productMainImg');
  // Render main image as background if value present, otherwise show placeholder text
  const mainVal = (p.images && p.images[0]) || '';
  main.style.background = 'linear-gradient(135deg,#fafafa,#e9e9e9)';
  main.style.backgroundImage = '';
  main.textContent = '';
  if(mainVal){
    main.style.backgroundImage = `url("${mainVal}")`;
    main.style.backgroundSize = 'cover';
    main.style.backgroundPosition = 'center';
  } else {
    main.textContent = 'Изображение';
  }

  const thumbs = document.getElementById('productThumbs');
  thumbs.innerHTML = '';
  (p.images || []).forEach((img, i) => {
    const m = document.createElement('div');
    m.className = 'mini' + (i===0 ? ' active' : '');
    m.tabIndex = 0;
    m.onclick = () => changeImg(i);
    m.onkeypress = (e) => { if(e.key === 'Enter') changeImg(i); };
    if(img){
      m.style.backgroundImage = `url("${img}")`;
      m.style.backgroundSize = 'cover';
      m.style.backgroundPosition = 'center';
    } else {
      m.textContent = 'placeholder';
    }
    thumbs.appendChild(m);
  });

  // defaults
  document.querySelectorAll('#colorOptions .option-btn').forEach((el, idx) => {
    el.classList.toggle('active', idx===0);
    el.setAttribute('aria-pressed', idx===0 ? 'true' : 'false');
  });
  document.querySelectorAll('#sizeOptions .option-btn').forEach((el, idx) => {
    el.classList.toggle('active', idx===0);
    el.setAttribute('aria-pressed', idx===0 ? 'true' : 'false');
  });

  goPage('product');
}

/* =========================
   changeImg(index) — меняет основное изображение (не менять имя)
   ========================= */
function changeImg(index){
  if(!currentProduct) return;
  const main = document.getElementById('productMainImg');
  const val = currentProduct.images[index] || '';
  main.style.backgroundImage = '';
  main.textContent = '';
  if(val){
    main.style.backgroundImage = `url("${val}")`;
    main.style.backgroundSize = 'cover';
    main.style.backgroundPosition = 'center';
  } else {
    main.textContent = 'Изображение';
  }
  document.querySelectorAll('#productThumbs .mini').forEach((el,i)=> el.classList.toggle('active', i===index));
}

/* =========================
   select(btn) — выбор опций (цвет/размер) (не менять имя)
   ========================= */
function select(btn){
  const parent = btn.parentElement;
  parent.querySelectorAll('.option-btn').forEach(el=>{ el.classList.remove('active'); el.setAttribute('aria-pressed','false'); });
  btn.classList.add('active');
  btn.setAttribute('aria-pressed','true');
}

/* =========================
   goPage(id) — переключение страниц (home, order, product, gen) (не менять имя)
   ========================= */
function goPage(id){
  document.querySelectorAll('.page').forEach(p => p.classList.toggle('active', p.id === id));
  if(id === 'order') renderCatalog(products.slice());
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* =========================
   openModal / closeModal (не менять имена)
   ========================= */
function openModal(){ document.getElementById('modalBackdrop').classList.add('show'); document.getElementById('modalBackdrop').setAttribute('aria-hidden','false'); }
function closeModal(){ document.getElementById('modalBackdrop').classList.remove('show'); document.getElementById('modalBackdrop').setAttribute('aria-hidden','true'); }

/* =========================
   placeOrder() — сохраняет опции и открывает модалку
   ========================= */
let lastOrder = null;
function placeOrder(){
  if(!currentProduct){ alert('Нет выбранного продукта'); return; }
  const color = document.querySelector('#colorOptions .option-btn.active')?.dataset?.value || null;
  const size = document.querySelector('#sizeOptions .option-btn.active')?.dataset?.value || null;
  lastOrder = { product: currentProduct.name, price: currentProduct.price, color, size, date: new Date().toISOString() };
  // TODO: интеграция отправки заказа на сервер
  openModal();
}

/* =========================
   Генерация: previewFile + submitGenerate
   ========================= */
function previewFile(e){
  const file = e.target.files && e.target.files[0];
  const preview = document.getElementById('filePreview');
  if(!file){ preview.style.backgroundImage=''; preview.textContent='Превью'; preview.setAttribute('aria-hidden','true'); return; }
  const reader = new FileReader();
  reader.onload = function(ev){ preview.style.backgroundImage = `url(${ev.target.result})`; preview.style.backgroundSize='cover'; preview.style.backgroundPosition='center'; preview.textContent=''; preview.setAttribute('aria-hidden','false'); };
  reader.readAsDataURL(file);
}

function submitGenerate(){
  const prompt = (document.getElementById('prompt')||{value:''}).value.trim();
  const email = (document.getElementById('email')||{value:''}).value.trim();
  const hint = document.getElementById('genHint'); hint.style.display='none'; hint.textContent='';
  if(!prompt){ hint.style.display='block'; hint.textContent='Поле промпта не может быть пустым.'; return; }
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;
  if(!email || !emailRegex.test(email)){ hint.style.display='block'; hint.textContent='Укажите корректный email.'; return; }
  const size = document.querySelector('#genSizeOptions .option-btn.active')?.dataset?.value || null;
  const payload = { prompt, email, size };
  // TODO: интегрировать API генерации и отправки почты
  alert('Запрос принят (локально). TODO интегрировать API.\n' + JSON.stringify(payload, null, 2));
}

/* =========================
   TYPEWRITER + показать кнопку
   ========================= */
document.addEventListener('DOMContentLoaded', ()=>{

  // рендер каталога при старте
  renderCatalog(products.slice());
  // set hero preview cards (use product images so you can change them centrally in products[])
  ['previewCard0','previewCard1','previewCard2'].forEach((id,i)=>{
    const el = document.getElementById(id);
    const prod = products[i];
    const img = prod && prod.images && (prod.images[1] || prod.images[0]) || '';
    if(el && img){
      el.style.backgroundImage = `url("${img}")`;
      el.style.backgroundSize = 'cover';
      el.style.backgroundPosition = 'center';
      el.textContent = '';
    }
  });

  // typewriter
  const typeEl = document.getElementById('typewriter');
  const phrase = 'Вы можете выбрать готовую 3d модель для печати или создать её с помощью ИИ по картинке.';
  typeEl.style.opacity = 1;
  let idx = 0;
  function twStep(){
    if(idx <= phrase.length){
      typeEl.textContent = phrase.slice(0, idx);
      idx++;
      setTimeout(twStep, 30);
    } else {
      typeEl.style.borderRight = 'none';
      setTimeout(()=> document.getElementById('heroOrder').classList.add('in-place'), 200);
    }
  }
  setTimeout(twStep, 500);

  // fade-up observer
  const obs = new IntersectionObserver(entries => { entries.forEach(en => { if(en.isIntersecting) en.target.classList.add('visible'); }); }, { threshold: 0.12 });
  document.querySelectorAll('.fade-up').forEach(el => obs.observe(el));

  // ESC closes modal
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

  // run checklist in console
  runChecklist();
});

/* =========================
   CHECKLIST
   Скрипт проверяет 13 пунктов и выводит JSON с результатами в консоль.
   Если все pass -> выводит "CHECKLIST PASSED".
   Если хоть один fail -> выводит "CHECKLIST FAILED" и объект с true/false.
   ========================= */
function runChecklist(){
  const results = {
    header_fixed: false,
    header_three_elements: false,
    brand_on_right_click_home: false,
    home_h1_white_and_subtitle: false,
    catalog_preview_yellow_and_three_cards_and_open_catalog: false,
    search_input_oninput_and_size: false,
    renderCatalog_and_10_products: false,
    card_hover_animation: false,
    product_page_main_and_thumbs_changeImg: false,
    gen_page_sizes_and_validation: false,
    no_green_shades: false,
    comments_product_fields_present: false,
    names_functions_exist: false
  };

  try {
    // 1) header fixed, background #ffffff, height 72px
    const header = document.querySelector('header.topbar');
    if(header){
      const cs = window.getComputedStyle(header);
      const isFixed = cs.position === 'fixed' || header.style.position === 'fixed';
      const bg = cs.backgroundColor.replace(/\s+/g,'');
      const heightPx = header.getBoundingClientRect().height;
      results.header_fixed = isFixed && (bg === 'rgb(255,255,255)' || bg.includes('#ffffff')) && Math.round(heightPx) === 72;
    }

    // 2) header has exactly 3 interactive elements in one line: left has 2 buttons and brand at right
    if(header){
      const leftBtns = header.querySelectorAll('.left button');
      const brand = header.querySelector('.brand');
      results.header_three_elements = (leftBtns.length === 2) && !!brand;
    }

    // 3) brand is clickable -> goPage('home')
    const brandEl = document.querySelector('.topbar .brand');
    results.brand_on_right_click_home = !!brandEl && typeof brandEl.onclick === 'function';

    // 4) home h1 white and subtitle exists
    const h1 = document.querySelector('#home h1.hero-title');
    const sub = document.querySelector('#home p.hero-sub');
    if(h1 && sub){
      const color = window.getComputedStyle(h1).color;
      results.home_h1_white_and_subtitle = color === 'rgb(255, 255, 255)' || color === 'rgb(255,255,255)';
    }

    // 5) catalog-preview bg #ffd400 and exactly 3 cards and open-catalog exists
    const cp = document.querySelector('.catalog-preview');
    if(cp){
      const bgc = window.getComputedStyle(cp).backgroundColor;
      const cards = cp.querySelectorAll('.catalog-card');
      const openBtn = cp.querySelector('.open-catalog');
      results.catalog_preview_yellow_and_three_cards_and_open_catalog =
        (bgc === 'rgb(255, 212, 0)' || bgc.includes('#ffd400')) && (cards.length === 3) && !!openBtn;
    }

    // 6) search input has oninput="searchModels(this.value)" and width/height 520x52
    const s = document.getElementById('searchInput');
    if(s){
      const attr = s.getAttribute('oninput') || '';
      const rect = s.getBoundingClientRect();
      results.search_input_oninput_and_size = attr.includes('searchModels(this.value)') && Math.round(rect.width) === 520 && Math.round(rect.height) === 52;
    }

    // 7) renderCatalog exists and products length 10 and catalogGrid children 10 after render
    const hasRender = typeof renderCatalog === 'function';
    const hasProducts = Array.isArray(products) && products.length === 10;
    if(hasRender){
      renderCatalog(products.slice());
      const grid = document.getElementById('catalogGrid');
      results.renderCatalog_and_10_products = hasProducts && grid && grid.children.length === 10;
    }

    // 8) card hover animation: check catalog-item has transition property
    const sample = document.querySelector('.catalog-item');
    if(sample){
      const cs = window.getComputedStyle(sample);
      results.card_hover_animation = cs.transition && cs.transition !== 'all 0s ease 0s';
    }

    // 9) product page has main image and thumbs and changeImg exists
    results.product_page_main_and_thumbs_changeImg = !!document.getElementById('productMainImg') && !!document.getElementById('productThumbs') && (typeof changeImg === 'function');

    // 10) gen page sizes and validation presence
    const ta = document.getElementById('prompt');
    const fp = document.getElementById('filePreview');
    const em = document.getElementById('email');
    let taOk=false, fpOk=false, emOk=false;
    if(ta){
      const r = ta.getBoundingClientRect();
      taOk = Math.round(r.width) === 720 && Math.round(r.height) === 240;
    }
    if(fp){
      const r = fp.getBoundingClientRect();
      fpOk = Math.round(r.width) === 240 && Math.round(r.height) === 240;
    }
    if(em){
      const r = em.getBoundingClientRect();
      emOk = Math.round(r.width) === 420 && Math.round(r.height) === 44;
    }
    results.gen_page_sizes_and_validation = taOk && fpOk && emOk && (typeof submitGenerate === 'function');

    // 11) no green shades in CSS (simple check)
    const head = document.head.innerText.toLowerCase();
    results.no_green_shades = !head.includes('green') && !head.includes('#0') && !head.includes('#00ff');

    // 12) comments // name = present in scripts
    let hasComments = false;
    Array.from(document.scripts).forEach(s => { if(s.textContent && s.textContent.indexOf('// name =') !== -1) hasComments = true; });
    results.comments_product_fields_present = hasComments;

    // 13) names/functions exist
    results.names_functions_exist = ['renderCatalog','searchModels','openProduct','changeImg','select','goPage','openModal','closeModal'].every(fn => typeof window[fn] === 'function');

  } catch(e){
    console.error('CHECKLIST error', e);
  }

  console.group('CHECKLIST');
  console.log(results);
  const all = Object.values(results).every(v=>v===true);
  if(all) console.log('CHECKLIST PASSED — все пункты выполнены.');
  else console.error('CHECKLIST FAILED', results);
  console.groupEnd();
}
</script>
</body>
</html>
